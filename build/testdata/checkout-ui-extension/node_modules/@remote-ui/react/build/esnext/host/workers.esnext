import { useRef, useEffect } from 'react';
import { terminate } from '@remote-ui/web-workers';

function useWorker(creator, ...args) {
  const workerRef = useRef(null);

  if (workerRef.current === null) {
    workerRef.current = creator(...args);
  }

  const {
    current: worker
  } = workerRef;
  useEffect(() => {
    return () => {
      terminate(worker);
    };
  }, [worker]);
  return worker;
}

export { useWorker };
