'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _rollupPluginBabelHelpers = require('../_virtual/_rollupPluginBabelHelpers.js');
var react = require('react');

function useRemoteSubscription(subscribable) {
  var _useState = react.useState(function () {
    return {
      subscribable: subscribable,
      value: subscribable.current
    };
  }),
      _useState2 = _rollupPluginBabelHelpers.slicedToArray(_useState, 2),
      state = _useState2[0],
      setState = _useState2[1];

  var valueToReturn = state.value;

  if (state.subscribable !== subscribable) {
    valueToReturn = subscribable.current;
    setState({
      subscribable: subscribable,
      value: valueToReturn
    });
  }

  react.useDebugValue(valueToReturn);
  react.useEffect(function () {
    var unsubscribe = subscribable.subscribe(checkForUpdates);
    checkForUpdates();
    return function () {
      unsubscribe();
    };

    function checkForUpdates() {
      var value = subscribable.current;
      setState(function (previousState) {
        if (previousState.subscribable !== subscribable || previousState.value === value) {
          return previousState;
        }

        return _rollupPluginBabelHelpers.objectSpread2(_rollupPluginBabelHelpers.objectSpread2({}, previousState), {}, {
          value: value
        });
      });
    }
  }, [subscribable]);
  return valueToReturn;
}

exports.useRemoteSubscription = useRemoteSubscription;
