function fromIframe(target, {
  terminate: shouldTerminate = true,
  targetOrigin = '*'
} = {}) {
  var _target$contentDocume;

  if (typeof window === 'undefined') {
    throw new Error(`You can only run fromIframe() in a browser context, but no window was found.`);
  } // We need to store the listener, because we wrap it to do some origin checking. Ideally,
  // weâ€™d instead store an `AbortController`, and use its signal to cancel the listeners,
  // but that isnâ€™t widely supported.


  const listenerMap = new WeakMap();
  const iframeLoadPromise = ((_target$contentDocume = target.contentDocument) === null || _target$contentDocume === void 0 ? void 0 : _target$contentDocume.readyState) === 'complete' ? Promise.resolve() : new Promise(resolve => {
    target.addEventListener('load', () => resolve(), {
      once: true
    });
  });
  return {
    async postMessage(message, transfer) {
      var _target$contentDocume2;

      if (((_target$contentDocume2 = target.contentDocument) === null || _target$contentDocume2 === void 0 ? void 0 : _target$contentDocume2.readyState) !== 'complete') {
        await iframeLoadPromise;
      }

      target.contentWindow.postMessage(message, targetOrigin, transfer);
    },

    addEventListener(event, listener) {
      const wrappedListener = event => {
        if (event.source !== target.contentWindow) return;
        listener(event);
      };

      listenerMap.set(listener, wrappedListener);
      self.addEventListener(event, wrappedListener);
    },

    removeEventListener(event, listener) {
      const wrappedListener = listenerMap.get(listener);
      if (wrappedListener == null) return;
      listenerMap.delete(listener);
      self.removeEventListener(event, wrappedListener);
    },

    terminate() {
      if (shouldTerminate) target.remove();
    }

  };
}

export { fromIframe };
