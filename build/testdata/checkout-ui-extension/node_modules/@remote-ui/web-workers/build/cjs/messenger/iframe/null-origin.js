'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var createMessenger = require('./create-messenger.js');
var constants = require('./constants.js');

function createNullOriginIframeMessenger(url) {
  return createMessenger.createIframeWorkerMessenger(url, function (iframe) {
    var IFRAME_SOURCE = "\n    <html>\n      <body>\n        <script>\n          window.addEventListener('message', function (event) {\n            var data = event.data;\n            if (data == null || typeof data.".concat(constants.IFRAME_RUN_IDENTIFIER, " !== 'string') return;\n\n            var workerScript = URL.createObjectURL(\n              new Blob(['importScripts(' + JSON.stringify(data.").concat(constants.IFRAME_RUN_IDENTIFIER, ") + ');']),\n            );\n\n            var worker = new Worker(workerScript);\n            worker.postMessage({__replace: event.ports[0]}, [event.ports[0]]);\n          });\n        </script>\n      </body>\n    </html>\n  ");
    iframe.setAttribute('sandbox', 'allow-scripts');
    iframe.srcdoc = IFRAME_SOURCE;
  });
}

exports.createNullOriginIframeMessenger = createNullOriginIframeMessenger;
