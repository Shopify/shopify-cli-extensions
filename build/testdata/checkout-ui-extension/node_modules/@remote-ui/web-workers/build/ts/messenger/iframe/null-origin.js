"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createNullOriginIframeMessenger = void 0;
const create_messenger_1 = require("./create-messenger");
const constants_1 = require("./constants");
function createNullOriginIframeMessenger(url) {
    return create_messenger_1.createIframeWorkerMessenger(url, (iframe) => {
        const IFRAME_SOURCE = `
    <html>
      <body>
        <script>
          window.addEventListener('message', function (event) {
            var data = event.data;
            if (data == null || typeof data.${constants_1.IFRAME_RUN_IDENTIFIER} !== 'string') return;

            var workerScript = URL.createObjectURL(
              new Blob(['importScripts(' + JSON.stringify(data.${constants_1.IFRAME_RUN_IDENTIFIER}) + ');']),
            );

            var worker = new Worker(workerScript);
            worker.postMessage({__replace: event.ports[0]}, [event.ports[0]]);
          });
        </script>
      </body>
    </html>
  `;
        iframe.setAttribute('sandbox', 'allow-scripts');
        iframe.srcdoc = IFRAME_SOURCE;
    });
}
exports.createNullOriginIframeMessenger = createNullOriginIframeMessenger;
