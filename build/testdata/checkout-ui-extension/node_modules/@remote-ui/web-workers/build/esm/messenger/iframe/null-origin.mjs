import { createIframeWorkerMessenger } from './create-messenger.mjs';
import { IFRAME_RUN_IDENTIFIER } from './constants.mjs';

function createNullOriginIframeMessenger(url) {
  return createIframeWorkerMessenger(url, function (iframe) {
    var IFRAME_SOURCE = "\n    <html>\n      <body>\n        <script>\n          window.addEventListener('message', function (event) {\n            var data = event.data;\n            if (data == null || typeof data.".concat(IFRAME_RUN_IDENTIFIER, " !== 'string') return;\n\n            var workerScript = URL.createObjectURL(\n              new Blob(['importScripts(' + JSON.stringify(data.").concat(IFRAME_RUN_IDENTIFIER, ") + ');']),\n            );\n\n            var worker = new Worker(workerScript);\n            worker.postMessage({__replace: event.ports[0]}, [event.ports[0]]);\n          });\n        </script>\n      </body>\n    </html>\n  ");
    iframe.setAttribute('sandbox', 'allow-scripts');
    iframe.srcdoc = IFRAME_SOURCE;
  });
}

export { createNullOriginIframeMessenger };
